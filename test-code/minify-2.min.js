"use strict";function asyncGeneratorStep(r,e,n,t,i,o,a){try{var u=r[o](a),c=u.value}catch(r){return void n(r)}u.done?e(c):Promise.resolve(c).then(t,i)}function _asyncToGenerator(u){return function(){var r=this,a=arguments;return new Promise(function(e,n){var t=u.apply(r,a);function i(r){asyncGeneratorStep(t,e,n,i,o,"next",r)}function o(r){asyncGeneratorStep(t,e,n,i,o,"throw",r)}i(void 0)})}}var UglifyJS=require("uglify-js"),fs=require("fs"),path=require("path"),babel=require("@babel/core"),reg=/(\w+)\.js$/;function handleJSString(n){return new Promise(function(t,r){var e=n.toString();babel.transform(e,{extends:"./.babelrc"},function(r,e){if(r)throw r;var n=UglifyJS.minify(e.code);if(n.error)throw n.error;t(n)})})}function minifyJs(i){return new Promise(function(){var n=_asyncToGenerator(regeneratorRuntime.mark(function r(e,n){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:fs.readFile(i,function(r,e){if(r)throw r;var n=handleJSString(e);if(n){var t=i.replace(reg,"$1.min.js");fs.writeFile(t,n,function(r){if(r)throw r})}});case 1:case"end":return r.stop()}},r)}));return function(r,e){return n.apply(this,arguments)}}())}function judgeDirectory(r){return _judgeDirectory.apply(this,arguments)}function _judgeDirectory(){return(_judgeDirectory=_asyncToGenerator(regeneratorRuntime.mark(function r(e){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",new Promise(function(n,t){fs.stat(e,function(r,e){r&&t(r),e.isDirectory()&&n(!0),n(!1)})}));case 1:case"end":return r.stop()}},r)}))).apply(this,arguments)}function handleFile(r){return _handleFile.apply(this,arguments)}function _handleFile(){return(_handleFile=_asyncToGenerator(regeneratorRuntime.mark(function r(e){var n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,judgeDirectory(e).then(function(r){return{isDirectory:r,err:null}}).catch(function(r){return console.error(r),{isDirectory:null,err:r}});case 2:if((n=r.sent).err)throw n.err;r.next=5;break;case 5:if(n.isDirectory)return r.abrupt("return",{isDirectory:!0});r.next=8;break;case 8:return minifyJs(e).catch(function(r){throw r}),r.abrupt("return",{isDirectory:!1});case 10:case"end":return r.stop()}},r)}))).apply(this,arguments)}function minifyDirAllJsFile(s){fs.readdir(s,function(){var n=_asyncToGenerator(regeneratorRuntime.mark(function r(e,n){var t,i,o,a,u,c;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(e)throw e;r.next=2;break;case 2:i=!(t=!0),o=void 0,r.prev=5,a=function(){var r=c.value;if(-1===r.indexOf(".js"))return"continue";if(-1!==r.indexOf("min.js"))return"continue";var e=path.resolve(s,r);handleFile(e).then(function(r){r.isDirectory&&minifyDirAllJsFile(e)}).catch(function(r){console.error(r)})},u=n[Symbol.iterator]();case 8:if(t=(c=u.next()).done){r.next=15;break}if("continue"===a())return r.abrupt("continue",12);r.next=12;break;case 12:t=!0,r.next=8;break;case 15:r.next=21;break;case 17:r.prev=17,r.t0=r.catch(5),i=!0,o=r.t0;case 21:r.prev=21,r.prev=22,t||null==u.return||u.return();case 24:if(r.prev=24,i)throw o;r.next=27;break;case 27:return r.finish(24);case 28:return r.finish(21);case 29:case"end":return r.stop()}},r,null,[[5,17,21,29],[22,,24,28]])}));return function(r,e){return n.apply(this,arguments)}}())}module.exports=minifyDirAllJsFile;